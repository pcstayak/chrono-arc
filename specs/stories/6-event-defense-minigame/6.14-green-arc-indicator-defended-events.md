### User Story 6.14

**Number:** `6.14`
**ID:** `BA-US-green-arc-indicator-defended-events`
**Role:** `player`
**Story:** `As a player, I want to see defended events displayed as green points on the timeline arc so that I can visually track which events I've successfully protected and feel a sense of accomplishment.`

**Context / Background:**
- After successfully defending an event through a mini-game, the event's state changes from "attacked" (red) to "defended" (green)
- The timeline arc uses color to indicate event states: green (safe/defended), yellow (threatened), red (attacked)
- Defended events should display distinctly from never-attacked safe events to recognize player achievement
- This visual feedback reinforces success and provides clear progress tracking
- Educational goal: Visual reward for learning and successful knowledge application
- Game goal: Create satisfying visual feedback loop that motivates continued play

**Functional Requirements:**
1. Extend the event state model to distinguish between:
   - "safe" (never attacked, default green)
   - "defended" (successfully defended after attack, bright/highlighted green)
   - "threatened" (may be attacked soon, yellow)
   - "attacked" (currently under attack, red)
   - "corrupted" (failed defense, dark red or gray)
2. When a defense mini-game completes successfully:
   - Update event state from "attacked" to "defended"
   - Trigger timeline arc re-render
3. Render "defended" events with distinct visual styling:
   - Bright green color (e.g., #10B981 or similar vibrant green)
   - Optional: slightly larger dot or pulsing animation
   - Optional: subtle glow or highlight effect
4. Maintain "defended" state persistently (survives page refresh)
5. Display state in event card/panel when viewing a defended event
6. Optionally: Track defense timestamp and display "Defended on [date]" in event card
7. Update segment color stacking to account for "defended" state
8. Ensure "defended" events count toward "safe" totals in segment state counts

**Non-Functional / UX Requirements:**
- State transition from "attacked" (red) to "defended" (green) should be immediate and visually clear
- Green color must be distinct from both default safe green and yellow/red
- Visual feedback should feel rewarding (subtle animation or highlight acceptable)
- Color choice must be accessible (sufficient contrast for colorblind players)
- State persistence must be reliable (no loss of defended status on refresh)
- Timeline arc re-render after defense success must be smooth (under 500ms)
- Defended indicator must be visible on both desktop and mobile
- Optional pulsing/glow effects must not be distracting or cause performance issues

**Data & State:**
- Inputs:
  - Event ID
  - Defense outcome (success/failure)
  - Current event state
  - Defense timestamp (when defense completed)
- Outputs:
  - Updated event state ("defended")
  - Timeline arc visual update (green point)
  - Event card status display (e.g., "✓ Successfully defended")
  - Optional: Defense history record (timestamp, player, mini-game type)
- State rules:
  - "defended" state is permanent (does not revert to "safe")
  - "defended" events can be attacked again (transitions to "attacked" state)
  - If defended event is attacked again and fails defense, transitions to "corrupted"
  - "defended" state is stored in event state data structure
  - State changes trigger reactive UI updates (timeline arc, event card)

**Validation & Edge Cases:**
- Event defended but state update fails: retry state update, show error if fails
- Timeline arc doesn't re-render after state change: force manual re-render trigger
- Player refreshes browser immediately after defense: state must persist
- Multiple players defend same event simultaneously (multiplayer): coordinate state updates
- Event is attacked again after being defended: state transitions to "attacked" (red)
- "defended" color is too similar to default "safe": use distinct shade or styling
- Colorblind player can't distinguish colors: use additional visual indicators (icons, patterns)
- Event state is corrupted or invalid: default to "safe" state

**Assumptions:**
- Event state data structure can accommodate "defended" as a distinct state
- Timeline arc rendering logic can handle multiple shades of green (safe vs defended)
- State persistence mechanism (database, local storage) is in place
- Timeline arc updates reactively when event states change
- Event card/panel UI can display defense status information
- Color palette has a vibrant green available for "defended" state
- Game state manager can reliably update and propagate state changes

**Out of Scope (for this story):**
- Detailed defense history UI showing all past defenses
- Statistics on defense success rate per event
- Leaderboards or social comparison of defended events
- Badges or achievements for defending multiple events
- Animated celebration effects beyond subtle highlight
- Sound effects when event turns green
- Visual "shield" icon or other metaphorical indicators (simple color is sufficient)
- Different green shades based on difficulty of defense
- "Cooldown" period before defended events can be attacked again (separate story)

**Acceptance Criteria (Gherkin-style):**
- Given I successfully complete a defense mini-game, when the outcome is processed, then the event's state is updated to "defended"
- Given an event's state is updated to "defended", when the timeline arc re-renders, then the event's point is displayed in bright green
- Given a defended event is displayed on the timeline, when I view it, then it is visually distinct from never-attacked safe events
- Given I refresh the browser after defending an event, when the page loads, then the event is still displayed as defended (green)
- Given I view a defended event's card, when I check its status, then I see an indication that it was successfully defended (e.g., "✓ Successfully defended")
- Given the timeline uses segment color stacking, when calculating segment colors, then "defended" events count toward the safe/green portion
- Given an event is defended, when I view the timeline arc, then the green color is accessible and distinct from yellow/red (sufficient contrast)
- Given a defended event is attacked again, when the attack triggers, then the event's point changes from green to red (attacked state)
- Given the timeline arc is displaying defended events, when rendering, then the UI renders smoothly in under 500ms

**Visual Design Recommendations:**

```
Event States and Colors:
- "safe" (never attacked): #22C55E (medium green)
- "defended" (successfully protected): #10B981 (bright emerald green) + optional subtle glow
- "threatened": #F59E0B (amber/yellow)
- "attacked": #EF4444 (red)
- "corrupted" (failed defense): #991B1B (dark red) or #6B7280 (gray)

Timeline Arc Rendering:
- Default safe events: solid green dot
- Defended events: solid bright green dot + 2px lighter green outline (optional)
- Optional enhancement: 1-second pulse animation on transition from red to green

Event Card Status Indicator:
- Show checkmark icon (✓) next to event title
- Display text: "Successfully defended" in green
- Optional: Show defense date/time
```

**Integration with Existing Epic 6 Stories:**

This story enhances:
- **6.4 (Answer Validation and Outcome):** After successful defense, trigger green state update
- **6.5 (Timeline Visual Attack Indicators):** Extend to include defended state visual
- **Epic 5 (Timeline Improvements):** Integrate defended state into segment color stacking
