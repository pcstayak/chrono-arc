### User Story 6.10

**Number:** `6.10`
**ID:** `BA-US-spot-the-anomaly-minigame`
**Role:** `player`
**Story:** `As a player, I want to find and click on historical errors or anachronisms in a visual representation of the event so that I can demonstrate my understanding of historical accuracy and defend the event from corruption.`

**Context / Background:**
- This mini-game tests the player's attention to detail and knowledge of historical context
- Players view a scene, diagram, or description related to the attacked event
- The scene contains 3-5 deliberate anachronisms or factual errors (e.g., wrong dates, items from wrong era, incorrect people)
- Player must identify and click/tap all errors within the scene
- This mini-game is particularly suitable for events with visual elements or clear historical context
- Educational goal: Reinforce understanding of what belongs in a specific time period and context
- Game goal: Provide a "hidden object" style challenge that's engaging and visual
- **Failure condition:** Missing any error or clicking too many incorrect items results in defense failure

**Functional Requirements:**
1. Generate or display a visual representation of the attacked event (image, diagram, or text scene)
2. Embed 3-5 deliberate anachronisms or errors in the representation:
   - Items from wrong time period (e.g., smartphone in medieval scene)
   - Incorrect dates or names
   - People who weren't involved
   - Technologies that didn't exist yet
   - Wrong geographic locations
3. Allow player to click/tap on suspected errors
4. Provide visual feedback when player clicks (highlight or mark the spot)
5. Allow player to un-click an error if they change their mind
6. Include a "Submit Findings" button to finalize selections
7. Validate that player identified all errors and only errors (no false positives)
8. If all errors found with no false positives: mark defense as successful
9. If any errors missed OR any incorrect clicks: mark defense as failed
10. Show visual feedback on found/missed/incorrect clicks after submission
11. Return defense outcome to game state system

**Non-Functional / UX Requirements:**
- Visual scene must be clear and readable on mobile devices (important elements at least 30px)
- Clickable error regions must be large enough for kids to tap accurately (minimum 40px hit area)
- Visual feedback when clicking: highlight or marker appears immediately
- Selected errors should be visually distinct (e.g., red circles or checkmarks)
- Instructions must be simple: "Find and click on all the historical mistakes in this scene"
- On mobile: ensure zoom doesn't interfere with clicking
- Scene should not be overwhelming (avoid too many small details)
- Response time for click registration: under 100ms
- Loading spot-the-anomaly mini-game: under 2 seconds (including images)
- Errors should be obvious to a kid who learned about the event, but not trivially obvious

**Data & State:**
- Inputs:
  - Event ID (to identify which event is being defended)
  - Visual scene or text description
  - List of anachronisms/errors embedded in the scene (with positions/identifiers)
  - Correct items that should not be clicked
- Outputs:
  - Displayed scene with embedded errors
  - Player's clicked positions/items
  - Validation result (success/failure)
  - Visual feedback on each click (correct error, missed error, false positive)
- State rules:
  - Player can click and un-click items any number of times before submission
  - Once "Submit Findings" is clicked, all selections are locked and validated
  - Player cannot change selections after submission
  - Validation requires finding ALL errors with ZERO false positives
  - Defense outcome is saved to event state

**Validation & Edge Cases:**
- Event lacks suitable visual content: generate text-based scene with embedded errors
- Event is too abstract to visualize: use text description or fallback to different mini-game type
- Player clicks on edge between error and correct item: use hit-box collision detection
- Player double-clicks same error: register as single click
- Player submits without finding all errors: validation fails (some errors missed)
- Player clicks correct items (false positives): validation fails
- Errors are too subtle for kids: ensure errors are clear if player knows the event facts
- Errors are too obvious (comedic anachronisms): ensure errors require actual knowledge
- Scene has too many clickable elements: limit total clickable areas to 8-12 max
- Player refreshes during mini-game: restore current clicks or restart
- Mobile device has small screen: ensure scene scales appropriately

**Assumptions:**
- Events have content suitable for creating visual scenes or detailed text descriptions
- Errors can be generated algorithmically or are pre-authored for each event
- Visual scenes can be illustrated or assembled from existing assets
- For text-based version: errors are embedded in sentences (wrong names, dates, facts)
- Player has explored the event's content and knows what's historically accurate
- Errors are unambiguous (clearly wrong, not matters of interpretation)
- Hit detection works reliably on both desktop (mouse) and mobile (touch)
- Number of total errors (3-5) is communicated to player or discoverable through exploration

**Out of Scope (for this story):**
- Partial credit for finding most errors
- Hints highlighting regions where errors are located
- Animated reveals of correct errors after failure
- Explanation of why each error is wrong
- Timer or time-pressure mechanics
- Multiple difficulty levels (varying number of errors)
- Audio cues when clicking errors
- Complex illustrations requiring professional art (use simple diagrams or text descriptions)

**Acceptance Criteria (Gherkin-style):**
- Given an event is attacked and assigned the Spot the Anomaly mini-game, when I view the defense interface, then I see a visual scene or description related to the event
- Given I am viewing the scene, when I examine it, then I can identify 3-5 elements that are historically inaccurate or anachronistic
- Given I suspect an error, when I click/tap on it, then it is visually marked (e.g., red circle appears)
- Given I marked an item, when I click it again, then the mark is removed (I can un-select)
- Given I have marked what I believe are all the errors, when I click "Submit Findings", then all selections are locked and validated
- Given I correctly identified all errors with no false positives, when validation completes, then the defense is successful and the event is marked as defended
- Given I missed any errors, when validation completes, then the defense fails
- Given I clicked any correct items (false positives), when validation completes, then the defense fails
- Given validation has completed, when I view the scene, then correct errors show green marks, missed errors show yellow marks, and false positives show red marks
- Given the mini-game is active, when I view the interface, then I see clear instructions: "Find and click on all the historical mistakes"
- Given I am on mobile, when I tap on small errors, then the hit detection accurately registers my taps
