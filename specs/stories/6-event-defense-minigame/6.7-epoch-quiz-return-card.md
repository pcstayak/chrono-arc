### User Story 6.7

**Number:** `6.7`
**ID:** `BA-US-epoch-quiz-return-card`
**Role:** `player`
**Story:** `As a player, I want the "Return Card" button to trigger a quiz about the overall epoch and neighboring events so that I can demonstrate broader historical knowledge and earn rewards for understanding the era's context.`

**Context / Background:**
- Currently, the "Return Card" button simply closes the event card and returns to the timeline
- This story transforms the button into a learning opportunity by triggering a different type of quiz
- Unlike the defense quiz (which is about the specific event being defended), this quiz tests broader epoch knowledge
- Questions focus on the historical era, neighboring events, and contextual understanding
- This is an optional quiz (player can choose to take it or just close the card another way)
- The quiz is available regardless of the event's security status (safe, attacked, etc.)
- Educational goal: Encourage players to learn about the broader historical context, not just individual events
- Game goal: Reward exploration and deep learning with bonuses, unlocks, or progress

**Functional Requirements:**
1. Replace or augment the "Return Card" button behavior:
   - Instead of immediately closing the card, trigger an epoch quiz
   - Or provide two options: "Close" (no quiz) and "Test Epoch Knowledge" (triggers quiz)
2. Generate a quiz with 3-5 questions focused on the epoch and neighboring events:
   - Questions about the historical era (e.g., "What major developments occurred during the Renaissance?")
   - Questions about events chronologically near the current event
   - Questions comparing/contrasting events in the same period
   - Questions about cause-and-effect relationships between events
3. Questions should NOT be about the current event itself (that was covered in the defense quiz)
4. Use the same quiz interface as the defense quiz (story 6.3) but with different content
5. Display clear instructions: "Test your knowledge of this era!" or similar
6. Answer all questions (no early termination on incorrect answers, unlike defense quiz)
7. Calculate a score or outcome based on number of correct answers (e.g., 3/5 correct)
8. Provide feedback on performance and optionally award rewards:
   - Bonus points, unlocks, badges, or progression bonuses
   - No penalty for wrong answers (this is optional learning, not high-stakes defense)
9. After quiz completion, close the card and return to the timeline

**Non-Functional / UX Requirements:**
- Button label should clearly indicate it triggers a quiz (e.g., "Test Epoch Knowledge" or "Earn Bonus")
- If player does not want to take the quiz, provide an alternative close method (e.g., "X" button, "Skip Quiz")
- Quiz interface should reuse the defense quiz component for consistency
- Instructions and questions should be kid-friendly (ages 7-12)
- Quiz should feel like a fun challenge, not a test (encouraging tone)
- Loading the quiz should not cause noticeable delay (under 1 second)
- Works on both desktop and mobile (same responsive requirements as defense quiz)
- Feedback on correct/incorrect answers should be friendly and educational (explain why answers are right/wrong if possible)

**Data & State:**
- Inputs:
  - Current event ID
  - Current event's epoch/era (e.g., "Renaissance", "Industrial Revolution")
  - List of neighboring events (chronologically adjacent)
  - List of all events in the same epoch
  - Game state (to determine available rewards)
- Outputs:
  - List of 3-5 generated quiz questions with answer choices
  - Player's selected answers
  - Quiz score (number correct / total questions)
  - Rewards earned (points, unlocks, badges, etc.)
  - Updated game state reflecting rewards
- State rules:
  - Epoch quiz is optional and can be skipped
  - Quiz is available for any event, regardless of security status
  - Player can take the epoch quiz multiple times for the same event (optionally with diminishing rewards)
  - Quiz state does not persist if player closes card mid-quiz (acceptable to lose progress)
  - Rewards are only awarded once per event (or with diminishing returns on repeat attempts)

**Validation & Edge Cases:**
- Event has no neighboring events (start or end of timeline): focus quiz on epoch-wide questions only
- Event is the only one in its epoch: generate broader questions about the time period (e.g., "What century did this occur?")
- Player closes the card mid-quiz: no reward, no penalty, quiz is abandoned
- Player takes the quiz multiple times: optionally reduce rewards or show a message ("You've already earned the bonus for this event")
- Quiz generation fails: show error message and fall back to simple close behavior
- Not enough events in the epoch to generate good questions: fall back to generic historical questions about the era
- Player has low progress and has not explored neighboring events: ensure questions are still answerable (use information visible in timeline)
- Epoch or era information is missing from event data: generate questions about chronological neighbors only

**Assumptions:**
- Events are tagged with epoch/era information (e.g., "Medieval", "Enlightenment", "Space Age")
- The game data structure allows querying events by epoch
- Neighboring events can be identified via timeline ordering
- The quiz component from story 6.3 is reusable for this different quiz type
- A question generation system can create epoch-specific questions (or questions are pre-authored)
- The reward system exists and can accept new triggers (epoch quiz completion)
- Rewards are defined (points, badges, unlocks, etc.) and can be integrated
- The "Return Card" button is currently a simple close button that can be modified
- Players understand that this quiz is optional and different from the mandatory defense quiz

**Out of Scope (for this story):**
- Detailed explanations or educational content after quiz (just score and rewards)
- Advanced reward mechanics (e.g., streak bonuses, multipliers)
- Leaderboards or comparing epoch quiz scores with other players
- Question difficulty scaling based on player level
- Adaptive quiz that adjusts questions based on player performance
- Time limits or time pressure for epoch quiz
- Hints or lifelines during the quiz
- Achievements or badges specific to epoch mastery
- Unlocking new events or content through epoch quiz performance
- Tutorial or explanation of the epoch quiz mechanic (assumed to be self-explanatory)

**Acceptance Criteria (Gherkin-style):**
- Given I am viewing an event card, when I click the "Return Card" button (or equivalent), then an epoch quiz is triggered instead of immediately closing the card
- Given the epoch quiz is triggered, when I view the interface, then I see 3-5 questions about the historical era and neighboring events
- Given I am in the epoch quiz, when I view questions, then none of them are about the current event itself (focus is on context and neighbors)
- Given I am in the epoch quiz, when I answer a question incorrectly, then the quiz continues to the next question (no early termination)
- Given I complete the epoch quiz, when the quiz ends, then I see my score (e.g., "You got 4 out of 5 correct!")
- Given I complete the epoch quiz, when I achieve a passing score, then I am awarded rewards (points, badges, unlocks, etc.)
- Given I do not want to take the epoch quiz, when I view the card, then I have an alternative way to close the card without taking the quiz (e.g., "X" button or "Skip")
- Given I complete the epoch quiz, when rewards are awarded, then the card closes and I return to the timeline
- Given I take the epoch quiz multiple times for the same event, when I complete it again, then rewards are reduced or not awarded (diminishing returns)
- Given an event has no neighboring events, when the epoch quiz is generated, then questions focus on the overall time period instead
- Given an event is in a sparsely populated epoch, when the quiz is generated, then it still produces 3-5 answerable questions (uses broader historical knowledge)
- Given I am on mobile, when I interact with the epoch quiz, then the interface is responsive and easy to use
- Given I close the card mid-quiz, when I reopen the card, then the quiz does not resume (abandoned, no penalty)
