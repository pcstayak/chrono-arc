### User Story 6.3

**Number:** `6.3`
**ID:** `BA-US-quiz-game-integration`
**Role:** `player`
**Story:** `As a player, I want to answer quiz questions related to the attacked event so that I can demonstrate my knowledge and defend the event from being corrupted.`

**Context / Background:**
- This story covers the integration and display of the quiz game component when an event is attacked
- Questions must be generated based on the specific event content that the player could have learned before the attack
- The quiz should feel relevant, fair, and age-appropriate for kids aged 7-12
- Questions should test understanding of key facts, dates, people, and concepts related to the event
- The quiz interface should be simple, focused, and free of distractions
- Educational goal: Use retrieval practice (answering questions from memory) to reinforce learning
- Game goal: Create a sense of challenge and accomplishment when defending an event
- **UPDATED:** Question generation must ensure variety and avoid self-referential questions to improve educational value

**Functional Requirements:**
1. Load the quiz game component in the right-side column when an event is attacked
2. Generate or retrieve exactly 5 quiz questions related to the attacked event
3. Questions should be based on information the player encountered while exploring the event
4. Display questions one at a time (not all at once)
5. Provide 2-4 answer choices per question (multiple choice format)
6. Ensure exactly one answer is correct per question
7. Use simple, kid-friendly language in questions and answers
8. Display clear instructions at the start: "Defend this event by answering questions correctly"
9. Show progress indicator (e.g., "Question 2 of 5")
10. Questions should cover different aspects of the event (not all about the same detail)
11. **NEW:** Generate unique incorrect answer options for each event's quiz (not reused across different events)
12. **NEW:** Ensure incorrect answers are contextually relevant (from the same era, similar inventions, related concepts)
13. **NEW:** Do not include questions where the answer is the name of the current event being defended (no self-referential questions)
14. **NEW:** Questions should test knowledge ABOUT the event, not just name recognition

**Non-Functional / UX Requirements:**
- Quiz interface must be readable on both desktop and mobile (responsive layout)
- Answer buttons must be large enough for kids to tap easily on mobile (minimum 40px height)
- Text should use clear, sans-serif font at appropriate size (at least 14px for kids)
- Questions and answers must be concise (avoid long paragraphs)
- Answer choices should be randomized in order to prevent pattern-based guessing
- Correct answer should not be disproportionately in one position (e.g., always "C")
- Interface should feel encouraging, not punitive, even when player is wrong
- Loading questions should not cause noticeable delay (under 1 second)
- **NEW:** Incorrect answers should be plausible enough to require actual knowledge (not obviously wrong)

**Data & State:**
- Inputs:
  - Event ID (to identify which event is being defended)
  - Event content (facts, dates, people, concepts for question generation)
  - Player's exploration history for this event (optional, to ensure questions are fair)
  - Fixed number of questions: 5
  - **NEW:** List of other events in the same era (for generating contextual incorrect answers)
  - **NEW:** Event name/title (to exclude from answer options)
- Outputs:
  - List of 5 generated quiz questions with answer choices
  - Currently displayed question and answers
  - Player's selected answer for each question
  - Progress through the quiz (question X of 5)
- State rules:
  - Quiz generates exactly 5 questions when defense begins (not regenerated if player refreshes)
  - Questions are presented sequentially (cannot skip ahead or go back)
  - Each question must be answered before proceeding to the next
  - Quiz state persists for the duration of the defense session
  - **NEW:** Each event's quiz has unique incorrect answers (not shared with other events' quizzes)

**Validation & Edge Cases:**
- Event has insufficient content to generate 5 good questions: use a mix of event-specific and era-related questions to reach 5 total
- Event content is very simple (only 1-2 facts): generate questions at varying difficulty (e.g., direct recall + inference) to reach 5 questions
- Player's exploration was minimal: quiz should still be fair, using only content that was definitely visible
- No exploration history available: generate questions from all event content (assume player could have seen it)
- Question text is too long for mobile display: truncate or rephrase to fit within UI constraints
- Answer choices are very similar: ensure choices are distinct enough for kids to differentiate
- All answer choices are obviously wrong except one: ensure distractors are plausible
- Player refreshes browser mid-quiz: should resume from the same question (if state is preserved) or restart (acceptable fallback)
- **NEW:** Not enough events in the same era to generate contextual incorrect answers: fall back to related concepts or nearby eras
- **NEW:** Question generation accidentally creates a self-referential question: validation should detect and regenerate the question
- **NEW:** All questions inadvertently have the same incorrect answers: ensure variety check passes before presenting quiz

**Assumptions:**
- Event content is structured in a way that supports automated question generation (facts, dates, names, etc.)
- A question generation algorithm or library exists or will be built as part of this story
- Alternatively, questions are pre-authored and tagged to events
- The right-side column layout has sufficient space for quiz UI (at least 300px wide on desktop)
- Quiz state can be stored in application state (Redux, Context, or similar) for persistence
- The quiz component is reusable and can be adapted for other events without code changes
- Answer validation is handled by story 6.4 (this story only displays and collects answers)
- Questions are generated in English (localization is out of scope)
- All events have enough content to generate at least 5 reasonable questions
- **NEW:** The game state includes information about which events belong to which era/time period
- **NEW:** There is a database or data structure of related events that can be queried for generating contextual incorrect answers
- **NEW:** The question generation algorithm can access the current event's name/title to exclude it from answer options

**Out of Scope (for this story):**
- Answer validation logic (covered in story 6.4)
- Determining the final defense outcome (covered in story 6.4)
- Difficulty progression or adaptive questioning
- Hints, lifelines, or help options during the quiz
- Timer or time pressure mechanics
- Scoring beyond pass/fail
- Detailed feedback explaining why an answer was correct or incorrect
- Question authoring UI or content management tools
- Support for question types other than multiple choice (e.g., true/false, fill-in-blank)
- Animations, sound effects, or visual flourishes
- Automatically adjusting question difficulty based on player performance across multiple quizzes

**Acceptance Criteria (Gherkin-style):**
- Given an event is attacked, when I view the event card, then the quiz game loads in the right-side column with clear instructions
- Given the quiz has loaded, when I view the interface, then I see one question displayed with 2-4 answer choices
- Given I am viewing a question, when I look at the answer choices, then they are presented in a random order (not the same order every time)
- Given I am viewing a question, when I select an answer, then my selection is visibly highlighted before proceeding
- Given I have answered a question, when I proceed, then the next question is displayed (if more remain)
- Given I am in the quiz, when I check the interface, then I see a progress indicator showing my position (e.g., "Question 2 of 5")
- Given the event has rich content, when questions are generated, then they cover different aspects of the event (not repetitive)
- Given the event has any amount of content, when questions are generated, then exactly 5 questions are presented
- Given I am on mobile, when I interact with the quiz, then all text is readable and buttons are easy to tap
- Given the quiz is in progress, when I view the interface, then I can clearly see which question I am on out of 5 total
- **NEW:** Given I am defending Event A, when I view the quiz, then the incorrect answer options are different from those in Event B's quiz
- **NEW:** Given two different events in the same era, when I compare their quizzes, then each has unique incorrect answers relevant to their specific context
- **NEW:** Given I am defending an event, when I view quiz questions, then none of the questions have the current event's name as an answer option
- **NEW:** Given I am defending "The Printing Press", when I view the quiz, then I do not see a question like "What is the name of this invention?" with "The Printing Press" as an option
- **NEW:** Given I am defending an event, when incorrect answers are generated, then they reference other events from the same era or related historical/scientific concepts
- **NEW:** Given an event is in the Renaissance era, when incorrect answers are generated, then they might include other Renaissance inventions, not random unrelated items
