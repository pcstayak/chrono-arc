### User Story 6.11

**Number:** `6.11`
**ID:** `BA-US-metadata-classification-minigame`
**Role:** `player`
**Story:** `As a player, I want to quickly sort facts and items into correct categories related to the attacked event so that I can demonstrate my understanding of what is relevant and defend the event from corruption.`

**Context / Background:**
- This mini-game tests the player's ability to categorize information and distinguish relevant from irrelevant
- Players see 8-12 fact cards or items related to (and unrelated to) the attacked event
- Categories might include: "Related to this event / Not related", "True facts / False facts", "Happened before / Happened after", etc.
- Player must drag or click items into the correct category buckets
- This mini-game is particularly suitable for events with clear categorical boundaries or relationships
- Educational goal: Reinforce critical thinking and information filtering skills
- Game goal: Provide fast-paced sorting challenge that feels dynamic
- **Failure condition:** Too many mistakes (more than 1-2) results in immediate defense failure

**Functional Requirements:**
1. Generate 8-12 fact cards or items, divided between:
   - Relevant/correct items (related to the event, true facts, appropriate era, etc.)
   - Irrelevant/incorrect items (unrelated events, false facts, wrong era, etc.)
2. Display two or more category buckets/columns (e.g., "Related" vs "Not Related")
3. Display all items in a neutral area or randomized list
4. Allow player to drag items into category buckets (desktop)
5. Allow player to tap item then tap category to assign (mobile)
6. Allow player to move items between buckets if they change their mind
7. Include a "Submit Classification" button to finalize sorting
8. Validate that items are sorted into correct categories
9. Allow 0-1 mistakes for success (strict accuracy requirement)
10. If 0-1 mistakes: mark defense as successful
11. If 2+ mistakes: mark defense as failed
12. Show visual feedback on correct/incorrect classifications after submission
13. Return defense outcome to game state system

**Non-Functional / UX Requirements:**
- Item cards must be readable and large enough to drag (minimum 50px height)
- Category buckets must be clearly labeled and visually distinct
- Drag-and-drop must work smoothly on desktop and mobile
- On mobile: provide tap-to-select-item then tap-category interface
- Items should be concise (1-2 sentences max per fact card)
- Visual feedback when dragging: item follows cursor/finger, buckets highlight when hovering
- Clear indication which items are in which bucket
- Instructions must be simple: "Sort these facts into the correct categories"
- Indicate acceptable error threshold: "You can make at most 1 mistake"
- Response time for validation: under 200ms
- Loading classification mini-game: under 1 second
- Text on cards must be readable for kids (minimum 14px font size)

**Data & State:**
- Inputs:
  - Event ID (to identify which event is being defended)
  - List of relevant facts/items related to the event
  - List of irrelevant facts/items (distractors from other events or false information)
  - Category definitions (e.g., "Related / Not Related", "True / False", "Before / After")
  - Correct category for each item
  - Maximum allowed mistakes (default: 1)
- Outputs:
  - Displayed items (randomized order)
  - Category buckets with labels
  - Player's classification for each item
  - Count of mistakes
  - Validation result (success/failure)
  - Visual feedback on each classification
- State rules:
  - Player can rearrange items any number of times before submission
  - Once "Submit Classification" is clicked, all classifications are locked and validated
  - Player cannot change classifications after submission
  - All items must be placed in categories before submission is allowed
  - Validation allows 0-1 mistakes for success, 2+ mistakes for failure
  - Defense outcome is saved to event state

**Validation & Edge Cases:**
- Event has insufficient related facts: generate items from fun facts, story content, and era context
- Distractors are too obviously wrong: ensure plausibility (same era, related topics)
- Distractors are too subtle: ensure kids who learned the event can distinguish them
- Player submits with some items uncategorized: disable submit button until all items are sorted
- Player drags item outside category buckets: return item to last valid position
- Ambiguous items that could fit multiple categories: avoid or ensure clear context
- Player refreshes during mini-game: restore current classifications or restart
- Mobile device struggles with drag-drop: provide clear tap-based interface
- Too many items to fit on screen: allow vertical scrolling within category buckets
- Items have very long text: truncate to 2 sentences and use tooltip for full text

**Assumptions:**
- Events have enough related content to generate 4-6 relevant items
- Distractors can be generated from other events in the same era or from false facts
- Category definitions are clear and unambiguous for kids
- Player has explored the event's content and can distinguish relevant from irrelevant
- Drag-drop libraries/components are available or will be implemented
- Two-category system is primary (can extend to 3 categories for complex events)
- Items are facts/statements, not images (text-based)
- Maximum allowed mistakes is communicated to player

**Out of Scope (for this story):**
- Partial credit based on percentage correct
- Hints revealing correct category for specific items
- Detailed explanations of why items belong in certain categories
- Timer or time-pressure mechanics (though may add later for difficulty)
- More than 3 categories (keep simple)
- Scoring system beyond pass/fail
- Sound effects for sorting items
- Animated feedback for correct/incorrect sorts

**Acceptance Criteria (Gherkin-style):**
- Given an event is attacked and assigned the Metadata Classification mini-game, when I view the defense interface, then I see 8-12 item cards and 2-3 category buckets
- Given I am viewing the classification mini-game, when I see the items, then they are displayed in a neutral area in random order
- Given I am on desktop, when I drag an item card, then it moves smoothly with my cursor and I can drop it into a category bucket
- Given I am on mobile, when I tap an item then tap a category, then the item moves into that category bucket
- Given I have sorted an item, when I want to change its category, then I can drag/tap it to a different bucket
- Given I have sorted all items, when I click "Submit Classification", then all classifications are locked and validated
- Given I made 0-1 mistakes, when validation completes, then the defense is successful and the event is marked as defended
- Given I made 2 or more mistakes, when validation completes, then the defense fails immediately
- Given validation has completed, when I view the items, then correctly sorted items show green highlights and incorrectly sorted items show red highlights
- Given not all items are categorized, when I try to submit, then the submit button is disabled
- Given the mini-game is active, when I view the interface, then I see clear instructions: "Sort these facts into the correct categories. You can make at most 1 mistake"
- Given the mini-game is active, when I view category buckets, then they are clearly labeled (e.g., "Related to this event" vs "Not related")
