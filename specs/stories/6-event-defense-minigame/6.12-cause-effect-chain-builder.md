### User Story 6.12

**Number:** `6.12`
**ID:** `BA-US-cause-effect-chain-builder`
**Role:** `player`
**Story:** `As a player, I want to connect causes and effects to the attacked event to demonstrate my understanding of historical context and relationships, so that I can successfully defend the event from corruption.`

**Context / Background:**
- This mini-game tests the player's understanding of causality and historical context
- Players see the attacked event at the center of the interface
- Around the center are 6-10 statements representing potential causes (what led to the event) and effects (what resulted from the event)
- Some statements are correct, others are incorrect or unrelated
- Player must connect the correct causes and effects to the central event
- This mini-game is particularly suitable for events with clear historical impact and antecedents
- Educational goal: Reinforce understanding of historical causality and context
- Game goal: Provide a visual, graph-like challenge that shows relationships
- **Failure condition:** Connecting incorrect items or missing too many correct connections results in defense failure

**Functional Requirements:**
1. Display the attacked event as a central node/card
2. Generate 6-10 statements distributed around the center:
   - 3-4 correct causes (what led to this event)
   - 3-4 correct effects (what resulted from this event)
   - 2-3 incorrect statements (unrelated causes/effects)
3. Display statements as cards/nodes positioned around the central event
4. Provide a connection mechanism:
   - Desktop: click event, then click statement to draw connection line
   - Mobile: tap event, then tap statement to create connection
5. Allow player to disconnect (remove) connections if they change their mind
6. Visual feedback: connected statements show line/arrow to central event
7. Include a "Submit Connections" button to finalize the chain
8. Validate that:
   - All correct causes and effects are connected
   - No incorrect statements are connected
9. Allow 0-1 mistakes (one incorrect connection or one missed connection)
10. If validation passes (0-1 mistakes): mark defense as successful
11. If validation fails (2+ mistakes): mark defense as failed
12. Show visual feedback on correct/incorrect/missed connections after submission
13. Return defense outcome to game state system

**Non-Functional / UX Requirements:**
- Central event card must be visually prominent (larger, highlighted, or centered)
- Surrounding statement cards must be readable (minimum 14px font, 2 sentences max)
- Connection lines must be clear and visible (minimum 2px width)
- On desktop: click-to-connect should feel intuitive (click event, click target, line appears)
- On mobile: tap-to-connect should work reliably without accidental connections
- Visual feedback when connecting: line animates from event to statement
- Clear indication of which statements are connected vs unconnected
- Instructions must be simple: "Connect the causes and effects that relate to this event"
- Indicate acceptable error threshold: "You can make at most 1 mistake"
- Response time for validation: under 200ms
- Loading cause-effect mini-game: under 1 second
- Layout must avoid overlapping statements (use radial or grid layout)

**Data & State:**
- Inputs:
  - Event ID (to identify which event is being defended)
  - Event title and description (displayed in center)
  - List of correct causes (3-4 statements about what led to the event)
  - List of correct effects (3-4 statements about what resulted from the event)
  - List of incorrect statements (2-3 unrelated or false causes/effects)
  - Maximum allowed mistakes (default: 1)
- Outputs:
  - Central event node
  - Surrounding statement nodes (randomized positions)
  - Player's connections (array of statement IDs connected to event)
  - Count of incorrect connections and missed connections
  - Validation result (success/failure)
  - Visual feedback on each statement (correct, incorrect, missed)
- State rules:
  - Player can connect and disconnect statements any number of times before submission
  - Once "Submit Connections" is clicked, all connections are locked and validated
  - Player cannot change connections after submission
  - Validation counts both incorrect connections (false positives) and missed connections (false negatives)
  - Combined mistakes must be â‰¤1 for success
  - Defense outcome is saved to event state

**Validation & Edge Cases:**
- Event has few clear causes/effects: generate from story content or use era context
- Causes and effects are ambiguous: ensure clear temporal and causal relationships
- Player submits without connecting anything: validation fails (all connections missed)
- Player connects all statements including incorrect ones: validation fails (too many incorrect)
- Player connects event to itself: prevent self-connection
- Statements are too long to fit in layout: truncate to 2 sentences, use tooltip for full text
- Mobile device has small screen: ensure statements don't overlap, use scrolling if needed
- Player refreshes during mini-game: restore current connections or restart
- Incorrect statements are too obviously wrong: ensure plausibility (related era, similar events)
- Too many statements to display clearly: limit to 10 total statements maximum

**Assumptions:**
- Events have identifiable causes (what led to it) and effects (what resulted)
- Causes and effects can be expressed as concise statements (2 sentences max)
- Player has explored the event's story and related content
- Correct causes/effects are unambiguous (not matters of historical debate)
- Incorrect statements are plausible but factually wrong
- Connection interface works reliably on both desktop (mouse) and mobile (touch)
- Visual layout can position 6-10 statements around a central node without overlap
- Lines/arrows can be drawn dynamically between nodes

**Out of Scope (for this story):**
- Partial credit based on percentage of correct connections
- Hints highlighting which statements are causes vs effects
- Detailed explanations of causal relationships after failure
- Distinguishing between direct and indirect causes/effects
- Timer or time-pressure mechanics
- Animated cause-effect chains showing historical flow
- Sound effects for connecting statements
- Multiple levels of causality (primary, secondary causes)

**Acceptance Criteria (Gherkin-style):**
- Given an event is attacked and assigned the Cause-Effect Chain Builder mini-game, when I view the defense interface, then I see the event in the center with 6-10 statements around it
- Given I am viewing the chain builder, when I see the statements, then some represent causes, some represent effects, and some are incorrect
- Given I am on desktop, when I click the central event then click a statement, then a connection line is drawn between them
- Given I am on mobile, when I tap the central event then tap a statement, then a connection line is drawn between them
- Given I have connected a statement, when I want to remove it, then I can click/tap the statement again to disconnect it
- Given I have connected the statements I believe are correct, when I click "Submit Connections", then all connections are locked and validated
- Given I connected all correct causes/effects with 0-1 total mistakes, when validation completes, then the defense is successful and the event is marked as defended
- Given I made 2 or more mistakes (incorrect connections or missed connections), when validation completes, then the defense fails
- Given validation has completed, when I view the interface, then correctly connected statements show green highlights, incorrectly connected statements show red highlights, and missed statements show yellow highlights
- Given the mini-game is active, when I view the interface, then I see clear instructions: "Connect the causes and effects that relate to this event. You can make at most 1 mistake"
- Given I am viewing the layout, when statements are displayed, then they do not overlap and are clearly readable
