### User Story 6.9

**Number:** `6.9`
**ID:** `BA-US-fact-matching-minigame`
**Role:** `player`
**Story:** `As a player, I want to drag missing words or facts into blanks within event descriptions so that I can demonstrate my knowledge recall and defend the event from corruption.`

**Context / Background:**
- This mini-game tests the player's recall of specific facts, names, dates, and concepts
- Players see a short event description (2-4 sentences) with 3-5 key words/phrases removed
- Missing content is displayed as blank spaces or highlighted gaps
- Player must drag the correct word/phrase from a word bank into each blank
- This mini-game is particularly suitable for events with specific names, dates, locations, or technical terms
- Educational goal: Reinforce memorization of key facts through cloze-test format
- Game goal: Provide interactive word-matching that feels like solving a puzzle
- **Failure condition:** Any incorrect match results in immediate defense failure

**Functional Requirements:**
1. Generate a short description (2-4 sentences) of the attacked event
2. Identify 3-5 key words/phrases to remove (names, dates, locations, technical terms)
3. Display the description with blanks replacing the removed words
4. Provide a word bank containing:
   - All correct answers
   - 2-3 plausible incorrect answers (distractors) per blank
5. Allow player to drag words from the word bank into blanks (desktop)
6. Allow player to tap word then tap blank to fill (mobile alternative)
7. Allow player to remove a word from a blank and return it to word bank
8. Include a "Submit Answers" button to finalize all matches
9. Validate that all blanks are filled with correct words
10. If all matches are correct: mark defense as successful
11. If any match is incorrect: mark defense as failed immediately
12. Show visual feedback on correct/incorrect matches after submission
13. Return defense outcome to game state system

**Non-Functional / UX Requirements:**
- Blanks must be clearly visible and large enough to accommodate words (minimum 80px width)
- Word bank items must be large enough to tap on mobile (minimum 40px height)
- Drag-and-drop must work smoothly on desktop and mobile
- On mobile: provide tap-to-select-word then tap-to-fill-blank alternative
- Words in word bank should be randomly ordered (not grouped by correct/incorrect)
- Visual feedback during interaction: word highlights when grabbed, blank highlights when hovering
- Clear indication when a blank is filled vs empty
- Instructions must be simple: "Fill in the missing words by dragging them into the blanks"
- Response time for validation: under 200ms
- Loading fact-matching mini-game: under 1 second
- Text must be readable for kids (minimum 14px font size)

**Data & State:**
- Inputs:
  - Event ID (to identify which event is being defended)
  - Event description or story content
  - List of key terms to remove (names, dates, technical terms)
  - Correct answer for each blank
  - Plausible distractors for each blank
- Outputs:
  - Event description with blanks
  - Word bank with correct answers and distractors (randomized order)
  - Player's matched words for each blank
  - Validation result (success/failure)
  - Visual feedback on each match
- State rules:
  - Player can rearrange words any number of times before submission
  - Once "Submit Answers" is clicked, all matches are locked and validated
  - Player cannot change matches after submission
  - All blanks must be filled before submission is allowed
  - Validation is all-or-nothing: every blank must have the correct word
  - Defense outcome is saved to event state

**Validation & Edge Cases:**
- Event description is too short: use event story content or expand with fun facts
- Event description has fewer than 3 removable key terms: use minimum 3 (add related facts)
- Event has complex technical terms kids won't know: simplify or use different mini-game type
- Player submits with some blanks unfilled: disable submit button until all blanks are filled
- Player drags word outside valid areas: return word to word bank
- Multiple words could fit grammatically but only one is historically correct: ensure clear context
- Word bank has duplicate words: ensure each word in bank is unique
- Player refreshes during mini-game: restore current matches or restart
- Mobile device struggles with drag-drop: provide clear tap-to-select interface
- Distractors are too obviously wrong: ensure plausibility (same era, related concepts)

**Assumptions:**
- Events have descriptions with identifiable key terms that can be removed
- Removed words are critical to understanding (names, dates, locations, not articles/prepositions)
- Player has read the event's story content before the attack
- Distractors are contextually plausible (same era, similar concepts) but factually wrong
- Word bank fits on screen without excessive scrolling (max 15-20 words total)
- Drag-drop libraries/components are available or will be implemented
- Each blank has exactly one correct answer (no ambiguous cases)
- Words in word bank are short enough to fit in blanks (max 3-4 words per phrase)

**Out of Scope (for this story):**
- Partial credit for mostly-correct matches
- Hints revealing first letter or word length
- Animated feedback showing correct answers after failure
- Explanation of why certain words are correct
- Timer or time-pressure mechanics
- Multiple difficulty levels (varying number of blanks)
- Synonyms or alternative correct answers
- Sound effects for word placement

**Acceptance Criteria (Gherkin-style):**
- Given an event is attacked and assigned the Fact Matching mini-game, when I view the defense interface, then I see a description with 3-5 blanks and a word bank
- Given I am viewing the fact matching mini-game, when I look at the word bank, then I see correct answers mixed with plausible distractors in random order
- Given I am on desktop, when I drag a word from the word bank, then it moves smoothly with my cursor and I can drop it into a blank
- Given I am on mobile, when I tap a word then tap a blank, then the word fills that blank
- Given I have filled a blank, when I want to change it, then I can drag/tap the word back to the word bank and select a different word
- Given I have filled all blanks, when I click "Submit Answers", then all matches are locked and validated
- Given I submitted all correct matches, when validation completes, then the defense is successful and the event is marked as defended
- Given I submitted any incorrect match, when validation completes, then the defense fails immediately
- Given validation has completed, when I view the description, then correct matches show green highlights and incorrect matches show red highlights
- Given not all blanks are filled, when I try to submit, then the submit button is disabled
- Given the mini-game is active, when I view the interface, then I see clear instructions: "Fill in the missing words"
