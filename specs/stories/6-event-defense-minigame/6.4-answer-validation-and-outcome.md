### User Story 6.4

**Number:** `6.4`
**ID:** `BA-US-answer-validation-and-outcome`
**Role:** `player`
**Story:** `As a player, I want my quiz answers to be validated immediately so that I know if I defended the event successfully or if it was corrupted due to incorrect answers.`

**Context / Background:**
- This story covers the logic for validating player answers and determining the defense outcome
- After the player selects an answer, the system must check if it is correct
- If the answer is correct, proceed to the next question
- If the answer is incorrect, end the quiz immediately and mark the event as "not defended"
- If all 5 questions are answered correctly, mark the event as "defended" and return it to safe status
- This creates meaningful stakes: one mistake means failure, encouraging careful learning
- Educational goal: Immediate feedback reinforces learning (player knows if they were right or wrong)
- Game goal: High stakes (no retries) motivate thorough exploration before attacks occur

**Functional Requirements:**
1. Validate the player's selected answer against the correct answer for the current question
2. If answer is correct: show positive feedback and proceed to the next question
3. If answer is incorrect: show negative feedback and immediately end the quiz
4. If all 5 questions are answered correctly: end the quiz and mark the event as "defended"
5. If any answer is incorrect: mark the event as "not defended"
6. Return the final defense outcome to the game state system
7. Update the event's security status based on outcome:
   - Defended: return to "safe" status
   - Not defended: update to "corrupted" or "lost" status (to be defined by game logic)
8. Display final outcome message to the player (success or failure)

**Non-Functional / UX Requirements:**
- Answer validation must happen instantly (under 100ms) for immediate feedback
- Feedback on correctness should be clear and age-appropriate (not harsh for wrong answers)
- Success message should be encouraging and celebratory (e.g., "Event defended! Great work!")
- Failure message should be supportive (e.g., "The event was lost, but you can explore others")
- Outcome message should display for at least 2-3 seconds before returning to normal UI
- Must work reliably across all browsers and devices
- No client-side answer manipulation should be possible (basic validation, not high-security)

**Data & State:**
- Inputs:
  - Player's selected answer for each question
  - Correct answer for each question
  - Current question number (1-5)
  - Event ID
- Outputs:
  - Correctness of each answer (correct/incorrect)
  - Final defense outcome (defended or not defended)
  - Updated event security status
  - Feedback messages for player
- State rules:
  - Once an answer is submitted, it cannot be changed
  - First incorrect answer immediately ends the quiz (no second chances)
  - Answering all 5 correctly is the only path to successful defense
  - Defense outcome is saved permanently in game state
  - Event status updates are persistent (survive page refresh)

**Validation & Edge Cases:**
- Player submits answer without selecting any choice: disable submit button until choice is made
- Player tries to change answer after submission: prevent interaction, answer is locked
- Network failure during answer submission: retry validation or show error and allow retry
- Validation logic returns unexpected result: log error and treat as incorrect for safety
- Player closes browser after answering incorrectly: outcome should still be saved (event remains "not defended")
- Player answers first 4 correctly, then gets 5th wrong: quiz ends, event is not defended
- Player answers all 5 correctly: quiz ends, event is defended, show success message
- Event status update fails: show error message and allow manual retry or auto-retry
- Multiple defense attempts in rapid succession: prevent concurrent defense sessions for the same event

**Assumptions:**
- Correct answers are stored securely (not easily accessible via browser dev tools)
- The quiz component can communicate with the game state system to update event status
- Event status changes trigger UI updates automatically (reactive state management)
- The game has defined states for "defended" (safe) and "not defended" (corrupted/lost)
- Players understand that one wrong answer means failure (this is explained in instructions)
- Validation happens client-side for speed, with optional server-side confirmation (if game has backend)
- The quiz cannot be restarted immediately after failure (cooldown or other game rule)

**Out of Scope (for this story):**
- Partial credit or scoring for partially correct answers (all-or-nothing only)
- Retry mechanism or second chances within the same defense session
- Detailed explanations of why an answer was wrong (just show correct/incorrect)
- Leaderboards or statistics tracking defense success rate
- Rewards or bonuses for successful defense (beyond returning event to safe status)
- Difficulty-based outcomes (e.g., harder quizzes give better rewards)
- Multiplayer coordination for defense
- Animations or visual effects for success/failure
- Sound effects or music cues

**Acceptance Criteria (Gherkin-style):**
- Given I select a correct answer, when I submit it, then I see positive feedback and the next question is displayed
- Given I select an incorrect answer, when I submit it, then I see negative feedback and the quiz ends immediately
- Given I answer all 5 questions correctly, when the quiz ends, then I see a success message and the event is marked as "defended"
- Given I answer any question incorrectly, when the quiz ends, then I see a failure message and the event is marked as "not defended"
- Given the quiz ends with success, when the outcome is saved, then the event's security status returns to "safe"
- Given the quiz ends with failure, when the outcome is saved, then the event's security status is updated to "corrupted" or "lost"
- Given I have answered a question, when I try to change my answer, then the interface prevents me (answer is locked)
- Given the quiz has ended, when I view the event card, then the UI lockdown is released (tabs are accessible again)
- Given validation completes, when the outcome is determined, then the result is persisted in game state and survives page refresh
