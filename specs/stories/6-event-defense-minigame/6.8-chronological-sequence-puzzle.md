### User Story 6.8

**Number:** `6.8`
**ID:** `BA-US-chronological-sequence-puzzle`
**Role:** `player`
**Story:** `As a player, I want to arrange shuffled historical steps or sub-events in correct chronological order so that I can demonstrate my understanding of the event's timeline and defend it from corruption.`

**Context / Background:**
- This mini-game tests the player's understanding of sequential relationships and cause-effect chains
- Players must arrange 4-6 shuffled cards/steps representing sub-events or phases of the main event
- The correct sequence is based on actual historical chronology
- This mini-game is particularly suitable for events with clear phases (e.g., wars, expeditions, inventions with development stages)
- Educational goal: Reinforce understanding of historical sequence and causality
- Game goal: Provide a visual, interactive challenge different from traditional quizzes
- **Failure condition:** Any incorrect ordering results in immediate defense failure

**Functional Requirements:**
1. Generate 4-6 sequential steps/sub-events from the attacked event's history
2. Display these steps as draggable cards in a randomized (incorrect) order
3. Provide a drag-and-drop interface (desktop) or tap-to-swap interface (mobile)
4. Allow player to rearrange cards into what they believe is the correct chronological order
5. Include a "Submit Order" button to finalize the arrangement
6. Validate the submitted order against the correct chronological sequence
7. If order is 100% correct: mark defense as successful
8. If order has any mistakes: mark defense as failed immediately
9. Show visual feedback on which cards are correctly/incorrectly positioned (after submission)
10. Return defense outcome to game state system

**Non-Functional / UX Requirements:**
- Cards must be large enough for kids to drag easily (minimum 60px height on mobile)
- Drag-and-drop must work smoothly on both desktop (mouse) and mobile (touch)
- On mobile: alternative tap-to-swap or tap-to-move interface if drag-drop is difficult
- Visual feedback during dragging (card follows cursor/finger, drop zones highlighted)
- Cards should show clear content: short description (1-2 sentences) and optional year/date
- Instructions must be simple: "Arrange these events in the order they happened"
- Color-coded feedback after submission: green border for correct position, red for incorrect
- Response time for validation: under 200ms
- Loading sequence puzzle: under 1 second

**Data & State:**
- Inputs:
  - Event ID (to identify which event is being defended)
  - Event content with sequential sub-events or development phases
  - Correct chronological order (array of step IDs)
  - Player's arranged order (array of step IDs)
- Outputs:
  - Array of steps/cards with descriptions, dates, and IDs
  - Initial randomized order for display
  - Player's submitted arrangement
  - Validation result (success/failure)
  - Visual feedback on each card position
- State rules:
  - Cards can be rearranged any number of times before submission
  - Once "Submit Order" is clicked, arrangement is locked and validated
  - Player cannot change arrangement after submission
  - Validation is all-or-nothing: every card must be in correct position
  - Defense outcome is saved to event state

**Validation & Edge Cases:**
- Event has fewer than 4 sequential steps: use minimum 4 steps (add context or related events)
- Event has more than 6 steps: select the 4-6 most important/distinct steps
- Event lacks clear sequential structure: fallback to different mini-game type
- Player submits without rearranging (keeps initial random order): validate normally (likely fails)
- Player drags card outside valid area: return card to last valid position
- Two steps have ambiguous order (happened simultaneously): treat either order as correct
- Mobile device doesn't support drag-drop smoothly: provide tap-to-swap alternative
- Player refreshes during puzzle: restore current arrangement or restart puzzle
- Content for steps is too long: truncate to 2 sentences maximum per card

**Assumptions:**
- Events suitable for this mini-game have clear sequential phases in their content
- Step descriptions are concise enough to fit on cards (2-3 sentences max)
- Drag-and-drop libraries/components are available or will be implemented
- Mobile touch interactions are tested and work reliably
- The correct order is unambiguous (no cases where multiple orders are equally valid)
- Steps include enough context clues (dates, cause-effect language) for player to reason
- Player has explored the event's story content before the attack (knows the sequence)

**Out of Scope (for this story):**
- Partial credit for mostly-correct sequences
- Hints showing years/dates as clues (unless part of card content)
- Animated transitions showing correct sequence after failure
- Explanation of why a particular order is correct
- Timer or time-pressure mechanics
- Multiple difficulty levels (varying number of cards)
- Sound effects for card interactions

**Acceptance Criteria (Gherkin-style):**
- Given an event is attacked and assigned the Sequence Puzzle mini-game, when I view the defense interface, then I see 4-6 shuffled cards with event steps
- Given I am viewing the sequence puzzle, when I see the cards, then they are displayed in a randomized order (not the correct chronological order)
- Given I am on desktop, when I click and drag a card, then it moves smoothly with my cursor and I can drop it in a new position
- Given I am on mobile, when I interact with cards, then I can rearrange them using touch gestures (drag or tap-to-swap)
- Given I have arranged the cards, when I click "Submit Order", then the arrangement is locked and validated
- Given I submitted the correct chronological order, when validation completes, then the defense is successful and the event is marked as defended
- Given I submitted an incorrect order, when validation completes, then the defense fails immediately
- Given validation has completed, when I view the cards, then correct positions show green borders and incorrect positions show red borders
- Given the puzzle is active, when I view the interface, then I see clear instructions: "Arrange these events in the order they happened"
- Given I try to drag a card outside the valid area, when I release it, then it returns to its last valid position
