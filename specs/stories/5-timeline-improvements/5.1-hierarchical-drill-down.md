### User Story 5.1

**Number:** `5.1`
**ID:** `BA-US-hierarchical-drill-down`
**Role:** `player`
**Story:** `As a player, I want to click on timeline segments to drill down into specific time periods and navigate back to broader views so that I can explore dense historical timelines without overwhelming clutter.`

**Context / Background:**
- As the game grows beyond 10-20 events, displaying all events simultaneously becomes cluttered and confusing
- Hierarchical segments allow players to start with a high-level view and progressively drill into details
- Segments represent time periods (e.g., Ancient Era, Medieval Period, 1800s, 1950-1960)
- Only key/summary events are shown at higher levels; detailed events appear when drilling down
- This mirrors real-world historical organization and helps kids understand how history is structured into periods
- Segments are visually distinct sections of the arc, each representing a span of time

**Functional Requirements:**
1. Display timeline segments as visually distinct sections along the arc at all hierarchical levels
2. When hovering over a segment, highlight only that segment in orange (not other segments or events)
3. Segments are clickable throughout their entire visual extent on the arc
4. Clicking a segment triggers a rebuild of the arc to show only events belonging to that segment
5. After drilling down, display a back button (e.g., in top-left of footer or above arc)
6. Clicking the back button returns to the previous (parent) level in the hierarchy
7. At the top level, the back button is either hidden or disabled
8. Track the current drill-down path (e.g., "All Time > 1900s > 1950-1960") for context
9. When rebuilding the arc after drill-down, render the arc curve and events for the new segment
10. Preserve smooth curve shape at all levels (arc doesn't suddenly flatten or become jagged)

**Non-Functional / UX Requirements:**
- Segment hover feedback must be instantaneous (no perceptible delay)
- Orange highlight should be clearly visible but not jarring
- Click target for segments should be generous (entire segment area, not just the arc line)
- Arc rebuild on drill-down should be fast (under 200ms)
- Back button must be clearly labeled ("Back" or "‚Üê Back to [parent name]")
- Back button must be large enough for touch interaction (minimum 44px height)
- On mobile, segments must be tappable without accidental activation of adjacent segments
- Visual feedback on click (e.g., brief flash or scale effect) to confirm interaction
- Maintain consistent curve proportions at all drill-down levels

**Data & State:**
- Inputs:
  - Hierarchical segment definitions (segment ID, name, date range, parent segment)
  - Current segment ID (which segment is currently displayed)
  - Event list filtered by current segment
  - Drill-down path (stack of segment IDs from top to current)
- Outputs:
  - Rendered arc with segments and events for current level
  - Highlighted segment on hover
  - Back button with appropriate label
  - Optional breadcrumb or path display
- State rules:
  - Drill-down path is maintained as a stack (push on drill-down, pop on back)
  - Top level has no back navigation available
  - Selected event is cleared when changing segments
  - Hover state is cleared when clicking (no lingering orange highlight after drill-down)
  - Segment rendering updates immediately on drill-down or back navigation

**Validation & Edge Cases:**
- Empty segment: show "No events in this period" message, disable drill-down
- Segment with no sub-segments: may show only events, no further drill-down available
- Maximum nesting depth: prevent drill-down beyond a defined limit (e.g., 3-4 levels)
- Rapid clicking: debounce segment clicks to prevent multiple simultaneous rebuilds
- Back button at top level: hide or disable to prevent confusion
- Very narrow segments: ensure they are still clickable (minimum width or extended hit area)
- Segment boundaries: handle edge cases where events fall exactly on boundaries
- Missing parent segment: gracefully handle data errors (fallback to top level)
- Browser back button: does not navigate segments (segments are not URL routes)

**Assumptions:**
- Events are pre-assigned to segments in the data structure
- Segment hierarchy is predefined and does not change during gameplay
- Segments are contiguous (no gaps between segments at any level)
- Each segment can contain both sub-segments and individual events
- At the top level, there are 3-7 major segments (e.g., Ancient, Classical, Medieval, Renaissance, Industrial, Modern, Contemporary)
- Drilling down one level reveals 2-10 sub-segments or individual events
- Maximum drill-down depth is 3-4 levels
- Arc rebuild does not require server communication (all data is client-side)

**Out of Scope (for this story):**
- Animated transitions when drilling down or going back (may add as enhancement)
- Displaying multiple levels simultaneously (e.g., zoomed-out overview)
- User-defined segment boundaries or custom groupings
- URL routing or deep linking to specific segments
- Segment search or jump-to-segment functionality
- Mini-map showing current position in hierarchy
- Undo/redo for navigation actions
- Keyboard shortcuts for navigation (arrow keys, escape for back)

**Acceptance Criteria (Gherkin-style):**
- Given I view the timeline at the top level, when I look at the arc, then I see multiple segments spanning the arc
- Given I hover over a segment, when my cursor enters the segment area, then only that segment highlights in orange
- Given I hover over a segment and move to another segment, when my cursor enters the new segment, then the orange highlight moves to the new segment
- Given I click on a segment, when the click registers, then the arc rebuilds to show only events and sub-segments within that segment
- Given I have drilled down into a segment, when the new view loads, then I see a back button above or near the arc
- Given I am in a drilled-down view, when I click the back button, then the timeline returns to the parent segment view
- Given I return to a parent level, when the view loads, then the arc shows the same segments I saw before drilling down
- Given I am at the top level, when I look for the back button, then it is either hidden or visually disabled
- Given I drill down multiple levels, when I click back repeatedly, then I return through each level in reverse order until reaching the top
- Given I am on mobile, when I tap a segment, then the drill-down works smoothly without accidental taps on adjacent segments
