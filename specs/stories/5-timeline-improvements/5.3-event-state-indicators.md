### User Story 5.3

**Number:** `5.3`
**ID:** `BA-US-event-state-indicators`
**Role:** `player`
**Story:** `As a player, I want event dots on the timeline to change color based on their state (safe, threatened, attacked) so that I can immediately see which events are in danger and need my attention.`

**Context / Background:**
- In the game, time bandits can threaten or attack historical events, attempting to erase them from history
- Events have three states: "safe" (normal), "threatened" (time bandit is approaching), "attacked" (under active attack)
- Visual state indicators on the timeline help players prioritize which events to defend
- Color is the primary indicator, making state changes immediately obvious
- This prepares the UI for upcoming multiplayer and time bandit gameplay features
- Educational goal: create urgency and engagement while teaching about historical cause-and-effect

**Functional Requirements:**
1. Render event dots in three distinct colors based on their current state:
   - Safe: Blue or green (calm, positive color)
   - Threatened: Orange or yellow (warning color)
   - Attacked: Red (danger, urgent color)
2. Update event dot colors dynamically when event states change
3. Ensure colors are visually distinct and recognizable at a glance
4. Apply consistent color scheme across all drill-down levels
5. Optionally add secondary visual indicators (e.g., pulsing animation for threatened/attacked events)
6. Event selection (clicked event) may overlay an additional highlight (e.g., white border) that works with any state color

**Non-Functional / UX Requirements:**
- Colors must be accessible and distinguishable for color-blind players (use standard safe palettes)
- Color transitions when state changes should be smooth (e.g., 200-300ms fade)
- Colors should be vibrant enough for kids to notice but not garish
- Attacked events should be highly noticeable (red + optional pulse/glow effect)
- Safe events should appear calm and non-urgent
- Threatened events should convey caution without panic
- Color scheme should match the game's overall visual design
- Performance must remain smooth even when many events change state simultaneously

**Data & State:**
- Inputs:
  - Event state for each event (safe/threatened/attacked)
  - State change events (when an event's state updates)
- Outputs:
  - Event dots rendered in appropriate colors
  - Optional animations or effects for non-safe states
- State rules:
  - Each event has exactly one state at any given time
  - State can change dynamically during gameplay (e.g., time bandit approaches)
  - State changes are immediate (dot color updates as soon as state changes)
  - New events start in "safe" state by default
  - State is independent of event selection (selected event can be in any state)

**Validation & Edge Cases:**
- All events in same state: timeline shows uniform color (acceptable, not an error)
- Rapid state changes: handle gracefully without excessive animation flickering
- Missing state data: default to "safe" state
- Invalid state value: log warning and default to "safe"
- State changes during arc rebuild: ensure new colors render correctly after rebuild
- Selected event changes state: maintain selection highlight while updating state color
- Color-blind mode: consider adding shape or pattern indicators in addition to color (future enhancement)

**Assumptions:**
- State data is provided by game logic external to the timeline component
- State changes are communicated via props or state management (e.g., React state, Redux)
- For MVP, all events start in "safe" state
- State changes will be tested by manually updating event data (simulated time bandit attacks)
- Color palette is predefined and matches game design guidelines:
  - Safe: #4A90E2 (blue) or #7ED321 (green)
  - Threatened: #F5A623 (orange) or #F8E71C (yellow)
  - Attacked: #D0021B (red) or #E74C3C (lighter red)
- Animations (pulse/glow) are optional enhancements and may be added if time permits
- State indicators apply to event dots only (labels do not change color)

**Out of Scope (for this story):**
- Detailed animation of time bandit attacks (deferred to future epic)
- Sound effects or audio alerts for state changes
- Historical state tracking (showing when an event was attacked in the past)
- Player notifications or pop-ups when events are threatened/attacked
- UI for defending or rescuing attacked events (future epic)
- State indicators on segment colors (covered in Story 5.4)
- Customizable color palettes or accessibility settings
- Multi-state events (e.g., partially attacked, recovering)

**Acceptance Criteria (Gherkin-style):**
- Given an event is in "safe" state, when I view the timeline, then the event dot is rendered in blue or green
- Given an event is in "threatened" state, when I view the timeline, then the event dot is rendered in orange or yellow
- Given an event is in "attacked" state, when I view the timeline, then the event dot is rendered in red
- Given an event's state changes from safe to threatened, when the state updates, then the dot color smoothly transitions to the threatened color
- Given an event is attacked, when I view the timeline, then the red dot is highly noticeable and conveys urgency
- Given I have selected an event, when I view the timeline, then the selection highlight is visible regardless of the event's state color
- Given multiple events are in different states, when I view the timeline, then I can easily distinguish safe, threatened, and attacked events by color
- Given I drill down into a segment, when the arc rebuilds, then event dots in the new view display correct state colors
- Given all events are safe, when I view the timeline, then the timeline appears calm with all blue/green dots
