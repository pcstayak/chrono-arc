### User Story 8.1

**Number:** `8.1`
**ID:** `BA-US-card-type-data-model`
**Role:** `system`
**Story:** `As a system, I want to store and distinguish between Event cards and Invention cards at the data model level so that all application logic can recognize and handle the two card types appropriately.`

**Context / Background:**
- This is the foundational story for Epic 8, establishing the data structure for dual card types
- Currently, the Event interface (types/domain.ts) treats all cards uniformly
- We need to add a card type field to distinguish events from inventions
- This change affects database schema, TypeScript types, sample data, and data access layers
- All existing cards must be classified as either "event" or "invention"
- This story does NOT include UI changes - only data model and backend logic
- Educational rationale: Separating events from inventions at the data level enables all downstream features (visual distinction, relationships, progression gates)

**Functional Requirements:**
1. Add a `cardType` field to the Event interface with values "event" or "invention"
2. Create a TypeScript enum or union type for CardType ("event" | "invention")
3. Update the Event interface in types/domain.ts to include cardType field
4. Classify all existing sample events (sampleEvents.ts) as either Event or Invention
5. Update database schema to include cardType field (if using Supabase, add column to events table)
6. Provide a default value of "event" for backward compatibility
7. Update data access layer functions to handle cardType field
8. Ensure cardType is required for new card creation but optional for legacy data

**Non-Functional / UX Requirements:**
- Data migration must be seamless (no breaking changes to existing functionality)
- cardType field must be indexed in database for efficient filtering (if applicable)
- TypeScript types must enforce cardType presence for new cards
- Data validation should reject invalid cardType values
- API responses should include cardType field in all card objects
- Performance impact of new field must be negligible (no query slowdown)

**Data & State:**
- Inputs:
  - Existing Event interface definition
  - Existing sample events data
  - Database schema (if using Supabase)
- Outputs:
  - Updated Event interface with cardType: CardType field
  - CardType type definition ("event" | "invention")
  - Updated sample events with cardType assigned to each
  - Updated database schema with cardType column
  - Migration script or strategy for existing data
- State rules:
  - cardType is required for all new cards created after this change
  - cardType defaults to "event" for legacy data if not specified
  - cardType cannot be changed after card creation (immutable)
  - Only two values are valid: "event" or "invention"
  - All database queries can optionally filter by cardType

**Validation & Edge Cases:**
- Card created without cardType: default to "event" and log warning
- Card created with invalid cardType value (e.g., "person"): reject with error
- Query filtering by cardType with invalid value: return empty result with error
- Legacy card data loaded without cardType: apply default "event" type
- Database migration fails: rollback changes and provide error message
- Sample data classification ambiguous (e.g., Gunpowder): use best judgment based on definition
- Relationship references card with unknown type: handle gracefully (don't crash)
- Export/import of card data: preserve cardType field
- API backward compatibility: ensure old clients can handle new field

**Assumptions:**
- The Event interface in types/domain.ts is the single source of truth for card data structure
- Sample events in lib/sampleEvents.ts will be manually classified
- Classification criteria:
  - Invention: A created thing (tool, machine, process, theory, technique) - focus on "what was made"
  - Event: A historical occurrence (war, discovery, movement, phenomenon) - focus on "what happened"
- Classification of ambiguous cases:
  - The Wheel: Invention (it's a created tool)
  - Great Pyramid: Event (the building of it is a historical occurrence; could debate, but leaning event)
  - Gunpowder: Invention (it's a created substance/formula)
  - Printing Press: Invention (it's a created machine)
  - Telescope: Invention (it's a created tool)
  - Steam Engine: Invention (it's a created machine)
  - Light Bulb: Invention (it's a created device)
  - Airplane: Invention (it's a created machine)
  - Internet: Invention (it's a created system/network)
  - Smartphone: Invention (it's a created device)
- Database uses Supabase PostgreSQL (if database changes needed)
- Migration can be done via ALTER TABLE or manual update for small dataset
- No existing production data to migrate (MVP stage)

**Out of Scope (for this story):**
- Visual representation of card types (Story 8.2)
- Relationship tracking between events and inventions (Story 8.3)
- Progression gates based on card type (Story 8.4)
- UI filtering or sorting by card type (Story 8.5)
- Creating new card types beyond Event and Invention
- Complex type hierarchies (e.g., subtypes of inventions)
- Content authoring tools for setting card types
- Analytics or reporting on card type distribution
- Renaming "Event" interface to more generic "Card" interface (could be future refactor)

**Acceptance Criteria (Gherkin-style):**
- Given the Event interface, when I inspect its definition, then I see a cardType field of type "event" or "invention"
- Given I create a new card with cardType "invention", when I save it, then it is stored with cardType "invention"
- Given I create a new card without specifying cardType, when I save it, then it defaults to "event"
- Given I try to create a card with cardType "invalid", when I save it, then I receive a validation error
- Given I load all sample events, when I inspect each card, then every card has a cardType value assigned
- Given I load a legacy card without cardType, when the data is retrieved, then it has cardType defaulted to "event"
- Given I query the database for cards, when I filter by cardType "invention", then I receive only Invention cards
- Given I query the database for cards, when I filter by cardType "event", then I receive only Event cards
- Given I update an existing card, when I try to change its cardType, then the system prevents the change (immutable)
- Given the sample events data, when I review classifications, then at least 6 cards are classified as "invention" (The Wheel, Printing Press, Telescope, Steam Engine, Light Bulb, Airplane, Internet, Smartphone)
