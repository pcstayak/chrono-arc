### User Story 8.4

**Number:** `8.4`
**ID:** `BA-US-invention-progression-gates`
**Role:** `player`
**Story:** `As a player, I want to unlock new epochs and events by collecting specific inventions so that I feel a sense of progression and achievement, and understand how certain technologies were necessary for historical periods to emerge.`

**Context / Background:**
- This story implements the game mechanic mentioned in the original requirement: "you cannot open an epoch until you have an invention"
- Progression gates create stakes and goals, motivating players to engage deeply with content
- Educational value: Reinforces the idea that technological innovations enable societal changes (e.g., can't have the Industrial Revolution without the steam engine)
- This adds strategic depth: players must prioritize which inventions to master first
- Gates should feel rewarding, not frustrating: clear communication of requirements and progress
- For kids aged 7-12, gates must be achievable and not create "hard blocks" that stop progress entirely
- This mechanic ties into the existing mastery system (Epic 7): players must unlock inventions by playing mini-games and defending cards
- Example gates:
  - Can't unlock "Industrial Era" epoch until you have Steam Engine invention
  - Can't unlock "Digital Age" epoch until you have Internet invention
  - Can't unlock certain Event cards until you have related Invention cards

**Functional Requirements:**
1. Define unlock requirements for epochs (e.g., "Industrial Era requires Steam Engine invention")
2. Define unlock requirements for specific Event cards (e.g., "World War II tech events require Airplane invention")
3. Check player's collected/unlocked inventions before allowing epoch or event access
4. Display locked state for gated epochs/events with clear messaging (e.g., "Unlock Steam Engine to explore this era")
5. Show unlock progress (e.g., "2/3 required inventions collected")
6. Unlock gated content automatically when requirements are met
7. Provide visual indicators for locked vs unlocked epochs/events (lock icon, grayed out, etc.)
8. Store player's unlocked inventions in persistent state (database or local storage)

**Non-Functional / UX Requirements:**
- Lock messaging must be positive and encouraging, not punitive (e.g., "Collect the Printing Press to unlock Renaissance events!" not "You are blocked")
- Unlock requirements should be visible before attempting to access gated content (no surprises)
- Visual indicators for locked content must be obvious to kids (big lock icon, clear text)
- Unlock celebrations should be satisfying (animation, sound, positive message) when gates are passed
- Must work on desktop and mobile (touch-friendly lock indicators)
- Performance: checking unlock requirements should be fast (under 100ms)
- Gated content should still be visible/discoverable (players know what they're working toward)

**Data & State:**
- Inputs:
  - Player's unlocked/mastered inventions (from mastery system, Epic 7)
  - Epoch and event unlock requirements (metadata defining which inventions are needed)
  - Player ID and session ID
- Outputs:
  - Lock/unlock state for each epoch and event
  - Visual lock indicators in UI (icons, grayed-out sections)
  - Progress messages (e.g., "2/3 inventions collected")
  - Unlock notifications when gates are passed
- State rules:
  - Epochs and events can have zero or more invention requirements (gates are optional)
  - A card can be gated by multiple inventions (e.g., require both Printing Press and Telescope)
  - Once a gate is unlocked, it remains unlocked permanently (no re-locking)
  - Unlock checks happen when player tries to access gated content and when game state updates
  - Unlocking an invention triggers re-check of all gated content
  - Default state is unlocked (only explicitly gated content is locked)

**Validation & Edge Cases:**
- Player tries to access gated epoch without required invention: show lock message, prevent access
- Player unlocks required invention while viewing locked content: immediately unlock and show celebration
- Gated content references non-existent invention: log error, treat as unlocked (fail open)
- Player has partial progress (1/2 inventions): show progress clearly
- Multiple gates unlock simultaneously (player unlocks invention that gates 3 epochs): show all unlock notifications
- Mobile view with lock messages: ensure text is readable and doesn't overflow
- Player refreshes page after unlocking gate: unlock state persists correctly
- Network failure during unlock check: use cached data or fail open (allow access)
- Circular dependencies (Epoch A requires Invention B, which is in Epoch A): prevent in content authoring, log error if detected

**Assumptions:**
- The mastery system (Epic 7) tracks which cards a player has unlocked/mastered
- "Unlocking" an invention means completing at least one mini-game or defending it successfully (can be refined)
- For MVP, gates apply to epochs and optionally to specific high-level events
- Gate metadata is stored in epoch/event definitions or a separate config
- Example gates for sample data:
  - No gates for Ancient Era (starting epoch is always unlocked)
  - Medieval Era: Unlock after mastering The Wheel (1 invention)
  - Industrial Era: Unlock after mastering Steam Engine or Light Bulb (1 of 2 inventions)
  - Modern Era: Unlock after mastering Airplane (1 invention)
  - Digital Era: Unlock after mastering Internet and Smartphone (2 inventions)
- Gates can use AND logic (require all inventions) or OR logic (require any of the inventions)
- For MVP, use simple AND logic (require all listed inventions)
- Unlock celebrations are brief (1-2 seconds) and non-intrusive
- Gated content is still visible in grayed-out or preview form (players see what they're working toward)

**Out of Scope (for this story):**
- Gates based on collecting a certain number of any inventions (e.g., "unlock after collecting 5 inventions")
- Gates based on mini-game scores or performance (e.g., "unlock after scoring 80% on Steam Engine quiz")
- Time-based gates (e.g., "unlock after 1 hour of gameplay")
- Gates based on Event cards (e.g., "unlock Epoch X after completing Event Y") - this story focuses on invention-based gates
- Complex gate logic (e.g., "require Invention A OR (Invention B AND Event C)")
- Player-chosen gates or difficulty settings (e.g., "hard mode with more gates")
- Hints or help system for how to unlock gated inventions
- Leaderboards or achievements for unlocking gates quickly
- Gates for mini-games or specific features (only epochs and events are gated)
- Temporary unlocks or time-limited access
- Sharing unlock progress with other players

**Acceptance Criteria (Gherkin-style):**
- Given an epoch requires the Steam Engine invention, when I try to access the epoch without the invention, then I see a lock icon and message "Unlock the Steam Engine to explore this era"
- Given an epoch requires the Steam Engine invention, when I unlock the Steam Engine by completing its mini-game, then the epoch is automatically unlocked and I see a celebration message
- Given an epoch requires 2 inventions and I have 1, when I view the epoch, then I see progress "1/2 inventions unlocked"
- Given I unlock the final required invention for an epoch, when the unlock happens, then I see a notification "New epoch unlocked: Industrial Era!"
- Given I try to access a gated event, when I don't have the required invention, then I see a clear message explaining what I need to unlock
- Given I view the timeline, when I see gated epochs/events, then they are visually distinct (grayed out, lock icon, etc.)
- Given I unlock multiple epochs at once (by mastering a key invention), when the unlock happens, then I see notifications for all unlocked content
- Given I refresh the page after unlocking a gate, when the page reloads, then the content remains unlocked (persistent state)
- Given an epoch has no unlock requirements, when I start the game, then the epoch is unlocked by default
- Given I am on mobile, when I view locked content, then the lock message and icon are clearly visible and readable
